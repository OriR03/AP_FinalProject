<!DOCTYPE html>
<html>
<head>
<title>Graph</title>
<style>
    body { font-family: sans-serif; margin: 0; }
    #cy {
        width: 100vw;
        height: 100vh;
        position: absolute;
        top: 0;
        left: 0;
    }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.23.0/cytoscape.min.js"></script>
</head>
<body>
<div id="cy"></div>
<script>
    /**
     * @param backgroundColor String input ා FFFBBC | FBC | FFBBCC can be used
     * https://www.fatalerrors.org/a/adaptive-text-color-based-on-background-color.html
     */
     function contrastTextColor(backgroundHexColor) {

        let hex = backgroundHexColor

        // If the currently passed in parameter starts with ා, remove the current parameter
        if (hex.startsWith('#')) {
            hex = hex.substring(1);
        }
        // If the current input is a 3-bit decimal value, it is directly converted to 6-bit for processing
        if (hex.length === 3) {
            hex = [hex[0], hex[0], hex[1], hex[1], hex[2], hex[2]].join('')
        }

        if (hex.length !== 6) {
            throw new Error('Invalid background color.' + backgroundHexColor);
        }

        const r = parseInt(hex.slice(0, 2), 16)
        const g = parseInt(hex.slice(2, 4), 16)
        const b = parseInt(hex.slice(4, 6), 16)

        if ([r,g,b].some(x => Number.isNaN(x))) {
            throw new Error('Invalid background color.' + backgroundHexColor);
        }

        const textColor = (r * 0.299 + g * 0.587 + b * 0.114) > 186 ? '#000' : '#FFF'
        return textColor
    }

    const nodes = [
        {__nodes__}
    ];
    const edges = [
        {__edges__}
    ];

    const elements = [...nodes, ...edges];
    const agentColor = '{__agentColor__}';
    const topicColor = '{__topicColor__}';

    function drawGraph() {
        const cy = cytoscape({
            container: document.getElementById('cy'),
            elements: elements,
            style: [ 
                {
                    selector: 'node[type="agent"]',
                    style: {
                        'shape': 'ellipse',
                        'background-color': '{__agentColor__}',
                        'label': 'data(label)',
                        'color': contrastTextColor(agentColor),
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'border-width': 2,
                        'border-color': '#999',
                        {__textSymbols__}
                    }
                },
                {
                    selector: 'node[type="topic"]',
                    style: {
                        'shape': 'rectangle',
                        'background-color': '{__topicColor__}',
                        'label': 'data(label)',
                        'color': contrastTextColor(topicColor),
                        'text-valign': 'center',
                        'text-halign': 'center',
                        'border-width': 2,
                        'border-color': '#999',
                        {__textSymbolsTopic__}
                }
                },
                {
                    selector: 'edge',
                    style: {
                        'width': 2,
                        'line-color': '#ccc',
                        'target-arrow-color': '#ccc',
                        'target-arrow-shape': 'triangle',
                        'curve-style': 'bezier'
                    }
                }
            ],
            layout: {
                name: '{__layoutName__}',
                grid: false,
                spacingFactor: 1.5
            }
        });
    }

    setTimeout(drawGraph, 0);
</script>
</body>
</html>